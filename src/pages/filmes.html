<!DOCTYPE html> <!-- Declaração do tipo de documento (HTML5) -->
<html lang="pt-BR"> <!-- Define a língua principal da página como Português do Brasil -->

<head>
    <meta charset="UTF-8" /> <!-- Define a codificação de caracteres para UTF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/src/assets/css/filmes.css" /> <!-- Importa a folha de estilos CSS para a página -->
    <!-- Ajusta a escala para dispositivos móveis -->
    <title>Todos os Filmes - FILMANIA</title> <!-- Define o título da página -->
</head>

<body>
    <div id="header"></div> <!-- Container para o cabeçalho da página -->
    <hr>
    <h1>Todos os Filmes</h1> <!-- Título principal da página -->
    <div class="movies-container" id="moviesContainer"></div> <!-- Container onde os filmes serão exibidos -->






    <script src="/src/assets/js/import.js"></script>
    
<script>

    const CHAVE_API = '1abf5fe580ef33d80c44d534b8e3b6d1';
    const URL_BASE = 'https://api.themoviedb.org/3/discover/movie';
    let paginaAtual = 1;
    let carregando = false;

    async function buscarFilmes() {
        if (carregando) return;
        carregando = true;

        const resposta = await fetch(`${URL_BASE}?api_key=${CHAVE_API}&language=pt-BR&page=${paginaAtual}`);
        const dados = await resposta.json();

        mostrarFilmes(dados.results);
        paginaAtual++;
        carregando = false;
    }

    function mostrarFilmes(filmes) {
    const container = document.getElementById('moviesContainer');

    // Filtra os que têm título e poster
    const filmesValidos = filmes.filter(filme => filme.poster_path && filme.title);

    // Ordena por título A-Z
    filmesValidos.sort((a, b) => a.title.localeCompare(b.title));

    filmesValidos.forEach(filme => {
        const card = document.createElement('div');
        card.className = 'filme-card';

        card.innerHTML = `
            <a href="detalhes.html?id=${filme.id}&tipo=movie" style="text-decoration: none;">
                <img src="https://image.tmdb.org/t/p/w500${filme.poster_path}" alt="${filme.title}">
                <div class="card-title">${filme.title}</div>
            </a>
            <button class="botao-favorito" onclick="adicionarFavorito(${filme.id})">Favoritar</button>
        `;
        container.appendChild(card);
    });
}


    // Detecta quando o usuário chega no fim da página
    window.addEventListener('scroll', () => {
        const { scrollTop, scrollHeight, clientHeight } = document.documentElement;

        if (scrollTop + clientHeight >= scrollHeight - 50) {
            buscarFilmes();
        }
    });


    function adicionarFavorito(id) {
            const favoritos = JSON.parse(localStorage.getItem('favoritos')) || []; // Recupera a lista de filmes favoritos do armazenamento local

            if (!favoritos.includes(id)) {
                favoritos.push(id); // Adiciona o filme à lista de favoritos se ainda não estiver nela
                localStorage.setItem('favoritos', JSON.stringify(favoritos)); // Salva a lista atualizada no armazenamento local
                alert("Filme favoritado!"); // Exibe um alerta ao usuário
            } else {
                alert("Este filme já está nos favoritos."); // Exibe um alerta se o filme já estiver nos favoritos
            }
    }

    buscarFilmes(); // Chama a função para buscar e exibir os filmes ao carregar a página
</script>
</body>

